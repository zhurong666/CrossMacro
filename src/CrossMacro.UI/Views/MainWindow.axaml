<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CrossMacro.UI.ViewModels"
        xmlns:tabs="using:CrossMacro.UI.Views.Tabs"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="600"
        x:Class="CrossMacro.UI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/mouse-icon.png"
        Title="CrossMacro"
        Width="700" Height="600"
        MinWidth="700" MinHeight="600"
        Background="#0F172A"
        TransparencyLevelHint="AcrylicBlur"
        ExtendClientAreaToDecorationsHint="True"
        SystemDecorations="None"
        CanResize="False"
        FontFamily="Inter, Segoe UI, DejaVu Sans, Noto Sans, Liberation Sans, sans-serif">

    <Design.DataContext>
        <vm:DesignMainWindowViewModel/>
    </Design.DataContext>

    <SplitView DisplayMode="CompactInline"
               IsPaneOpen="{Binding IsPaneOpen}"
               OpenPaneLength="200"
               CompactPaneLength="76"
               Background="#0F172A"
               PaneBackground="#1E293B">
        
        <SplitView.Pane>
            <Grid RowDefinitions="Auto,*,Auto">
                <!-- Header Row with Toggle and Title -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,16,0,8">
                    <ToggleButton IsChecked="{Binding IsPaneOpen}"
                                  Background="Transparent"
                                  Width="32" Height="32"
                                  CornerRadius="6"
                                  Padding="4"
                                  Margin="19,0,0,0"
                                  HorizontalAlignment="Left">
                         <ToggleButton.Styles>
                            <Style Selector="ToggleButton:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                <Setter Property="Background" Value="#334155"/>
                            </Style>
                            <Style Selector="ToggleButton:checked /template/ ContentPresenter#PART_ContentPresenter">
                                <Setter Property="Background" Value="Transparent"/>
                            </Style>
                             <Style Selector="ToggleButton:checked:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                <Setter Property="Background" Value="#334155"/>
                            </Style>
                        </ToggleButton.Styles>
                        <PathIcon Data="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"
                                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                                  Width="16" Height="16"/>
                    </ToggleButton>
                    
                    <!-- CrossMacro Title (visible when pane is open) -->
                    <TextBlock Text="CrossMacro"
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                               VerticalAlignment="Center"
                               Margin="12,0,0,0"
                               IsVisible="{Binding IsPaneOpen}"/>
                </StackPanel>
                
                <!-- Navigation List (Top) -->
                <ListBox Grid.Row="1" 
                         Name="TopNavListBox"
                         ItemsSource="{Binding TopNavigationItems}" 
                         SelectedItem="{Binding SelectedTopItem}"
                         Background="Transparent"
                         SelectionMode="Single"
                         VerticalAlignment="Top"
                         Margin="0,0">
                    <ListBox.Styles>
                         <Style Selector="ListBoxItem">
                             <Setter Property="Padding" Value="16,12"/>
                             <Setter Property="CornerRadius" Value="0"/>
                             <Setter Property="Margin" Value="0,2,0,2"/>
                             <Setter Property="Cursor" Value="Hand"/>
                             <Setter Property="Foreground" Value="#94A3B8"/> <!-- Slate-400 -->
                             <Setter Property="Background" Value="Transparent"/>
                             <Setter Property="BorderThickness" Value="3,0,3,0"/>
                             <Setter Property="BorderBrush" Value="Transparent"/>
                         </Style>
                         <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
                             <Setter Property="Background" Value="#334155"/> <!-- Slate-700 -->
                             <Setter Property="Foreground" Value="White"/>
                         </Style>
                         <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
                             <Setter Property="Background" Value="#0F172A"/> <!-- Slate-900 (Darker) -->
                             <Setter Property="Foreground" Value="White"/>
                         </Style>
                         <Style Selector="ListBoxItem:selected">
                             <Setter Property="BorderThickness" Value="3,0,3,0"/>
                             <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}"/>
                         </Style>
                    </ListBox.Styles>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center"
                                        ToolTip.Tip="{Binding Label}"
                                        ToolTip.ShowDelay="400">
                                <Border Width="32" Height="32" Background="Transparent">
                                     <TextBlock Text="{Binding Icon}" 
                                               FontSize="20" 
                                               FontFamily="Segoe UI Emoji, Noto Color Emoji, Apple Color Emoji, sans-serif"
                                               HorizontalAlignment="Center" 
                                               VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="{Binding Label}" 
                                           VerticalAlignment="Center" 
                                           FontWeight="SemiBold"
                                           FontSize="14"
                                           TextTrimming="CharacterEllipsis"
                                           IsVisible="{Binding $parent[SplitView].IsPaneOpen}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Navigation List (Bottom/Settings) -->
                <ListBox Grid.Row="2" 
                         Name="BottomNavListBox"
                         ItemsSource="{Binding BottomNavigationItems}" 
                         SelectedItem="{Binding SelectedBottomItem}"
                         Background="Transparent"
                         SelectionMode="Single"
                         VerticalAlignment="Bottom"
                         Margin="0">
                    <ListBox.Styles>
                         <Style Selector="ListBoxItem">
                             <Setter Property="Padding" Value="16,12"/>
                             <Setter Property="CornerRadius" Value="0"/>
                             <Setter Property="Margin" Value="0,2,0,2"/>
                             <Setter Property="Cursor" Value="Hand"/>
                             <Setter Property="Foreground" Value="#94A3B8"/> <!-- Slate-400 -->
                             <Setter Property="Background" Value="Transparent"/>
                             <Setter Property="BorderThickness" Value="3,0,3,0"/>
                             <Setter Property="BorderBrush" Value="Transparent"/>
                         </Style>
                         <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
                             <Setter Property="Background" Value="#334155"/> <!-- Slate-700 -->
                             <Setter Property="Foreground" Value="White"/>
                         </Style>
                         <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
                             <Setter Property="Background" Value="#0F172A"/> <!-- Slate-900 (Darker) -->
                             <Setter Property="Foreground" Value="White"/>
                         </Style>
                         <Style Selector="ListBoxItem:selected">
                             <Setter Property="BorderThickness" Value="3,0,3,0"/>
                             <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}"/>
                         </Style>
                    </ListBox.Styles>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center"
                                        ToolTip.Tip="{Binding Label}"
                                        ToolTip.ShowDelay="400">
                                <Border Width="32" Height="32" Background="Transparent">
                                     <TextBlock Text="{Binding Icon}" 
                                               FontSize="20" 
                                               FontFamily="Segoe UI Emoji, Noto Color Emoji, Apple Color Emoji, sans-serif"
                                               HorizontalAlignment="Center" 
                                               VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="{Binding Label}" 
                                           VerticalAlignment="Center" 
                                           FontWeight="SemiBold"
                                           FontSize="14"
                                           TextTrimming="CharacterEllipsis"
                                           IsVisible="{Binding $parent[SplitView].IsPaneOpen}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </SplitView.Pane>

        <SplitView.Content>
            <Grid RowDefinitions="Auto,Auto,*,Auto">
                
                <!-- Window Title Bar Area (Drag Handle & Controls) -->
                <Grid Grid.Row="0" Height="40" Background="Transparent" ColumnDefinitions="*,Auto">
                    <Border Background="Transparent" PointerPressed="OnTitleBarPointerPressed"/>
                    
                    <!-- Window Controls -->
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                Spacing="8"
                                Margin="0,0,10,0"
                                IsVisible="{Binding IsCloseButtonVisible}">
                        
                        <!-- Minimize Button -->
                        <Button Width="32" Height="32"
                                Background="Transparent"
                                Foreground="#94A3B8"
                                Click="OnMinimizeWindow"
                                ToolTip.Tip="Minimize">
                            <TextBlock Text="â”€" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Button>
                        
                        <!-- Close Button -->
                        <Button Width="32" Height="32"
                                Background="Transparent"
                                Foreground="#94A3B8"
                                Click="OnCloseApp"
                                ToolTip.Tip="Close">
                             <Button.Styles>
                                <Style Selector="Button:pointerover /template/ ContentPresenter">
                                    <Setter Property="Background" Value="#EF4444"/>
                                </Style>
                                <Style Selector="Button:pointerover">
                                    <Setter Property="Foreground" Value="White"/>
                                </Style>
                            </Button.Styles>
                            <TextBlock Text="âœ•" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Warning Banner -->
                <Border Grid.Row="1" 
                        Background="#F59E0B" 
                        Padding="12,8"
                        IsVisible="{Binding HasExtensionWarning}"
                        Margin="0,0,0,10">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <TextBlock Grid.Column="0" Text="âš ï¸" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" 
                                  Text="{Binding ExtensionWarning}" 
                                  Foreground="Black"
                                  FontWeight="Bold"
                                  TextWrapping="Wrap"
                                  VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- Main Content Display -->
                <!-- Added stretch alignment and adjusted margins -->
                <TransitioningContentControl Grid.Row="2" 
                                           Content="{Binding CurrentPage}" 
                                           Margin="16,0,16,16" 
                                           HorizontalAlignment="Stretch" 
                                           VerticalAlignment="Stretch">
                     <TransitioningContentControl.PageTransition>
                        <CrossFade Duration="0:00:00.250" />
                    </TransitioningContentControl.PageTransition>
                </TransitioningContentControl>

                <!-- Footer (Version / Status) -->
                <Grid Grid.Row="3" ColumnDefinitions="Auto,*,Auto" Margin="24,0,24,20" VerticalAlignment="Bottom">
                    <TextBlock Grid.Column="0"
                               FontSize="12"
                               FontWeight="Bold"
                               Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                               VerticalAlignment="Center">
                        <Run Text="ðŸ–±ï¸ CrossMacro "/><Run Text="{Binding AppVersion}"/>
                    </TextBlock>
                    <TextBlock Grid.Column="2" 
                               Text="{Binding GlobalStatus}" 
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
                               FontSize="11" 
                               HorizontalAlignment="Right"
                               VerticalAlignment="Center"/>
                </Grid>
                
                <!-- Update Notification (Overlay) -->
                <Border Grid.Row="2"
                        Background="#1E293B"
                        BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="12"
                        Margin="0,0,20,20"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Bottom"
                        IsVisible="{Binding IsUpdateNotificationVisible}"
                        BoxShadow="0 4 12 4 #40000000">
                    <Border.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Opacity" Duration="0:0:0.3"/>
                            <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.3" Easing="CubicEaseOut"/>
                        </Transitions>
                    </Border.Transitions>
                    
                    <StackPanel Spacing="8" Width="240">
                        <Grid ColumnDefinitions="*,Auto">
                            <StackPanel Spacing="2">
                                <TextBlock Text="Update Available" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding LatestVersion, StringFormat='v0 is available'}" 
                                          FontSize="12" 
                                          Foreground="#94A3B8"/>
                            </StackPanel>
                            
                            <Button Grid.Column="1" 
                                    Command="{Binding DismissUpdateNotification}"
                                    Background="Transparent"
                                    Padding="4"
                                    VerticalAlignment="Top"
                                    Margin="8,-4,-4,0">
                                <TextBlock Text="âœ•" FontSize="11" Foreground="#64748B"/>
                            </Button>
                        </Grid>
                        
                        <Button Command="{Binding OpenUpdateUrl}"
                                HorizontalAlignment="Stretch"
                                Background="{DynamicResource SystemAccentColor}"
                                Foreground="White"
                                CornerRadius="4"
                                Padding="6">
                            <TextBlock Text="View on GitHub" 
                                      HorizontalAlignment="Center" 
                                      FontSize="12"
                                      FontWeight="SemiBold"/>
                        </Button>
                    </StackPanel>
                </Border>

            </Grid>
        </SplitView.Content>

    </SplitView>

</Window>
