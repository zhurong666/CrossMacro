app-id: io.github.alper-han.CrossMacro
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: crossmacro

finish-args:
  # X11 Access (Required for XTest, XInput2)
  - --share=ipc
  - --socket=x11
  
  # Network access (Update check)
  - --share=network
  
  # - IBus for input method detection
  - --talk-name=org.kde.keyboard
  
  # User files (macro save/load)
  - --filesystem=xdg-documents/CrossMacro:create
  - --filesystem=xdg-config/CrossMacro:create

modules:
  - name: crossmacro
    buildsystem: simple
    build-commands:
      # Copy all app files to lib directory (keeps DLLs together with binary)
      - mkdir -p /app/lib/crossmacro
      - cp -r * /app/lib/crossmacro/ || true
      - chmod +x /app/lib/crossmacro/CrossMacro.UI
      
      # Create wrapper script in bin
      - mkdir -p /app/bin
      - |
        cat > /app/bin/crossmacro << 'EOF'
        #!/bin/sh
        exec /app/lib/crossmacro/CrossMacro.UI "$@"
        EOF
      - chmod +x /app/bin/crossmacro
      
      # Desktop entry
      - install -Dm644 io.github.alper-han.CrossMacro.desktop /app/share/applications/io.github.alper-han.CrossMacro.desktop
      
      # Icons
      - install -Dm644 icons/512x512/apps/crossmacro.png /app/share/icons/hicolor/512x512/apps/io.github.alper-han.CrossMacro.png
      - install -Dm644 icons/256x256/apps/crossmacro.png /app/share/icons/hicolor/256x256/apps/io.github.alper-han.CrossMacro.png
      - install -Dm644 icons/128x128/apps/crossmacro.png /app/share/icons/hicolor/128x128/apps/io.github.alper-han.CrossMacro.png
      
      # Metainfo
      - install -Dm644 io.github.alper-han.CrossMacro.metainfo.xml /app/share/metainfo/io.github.alper-han.CrossMacro.metainfo.xml

    sources:
      - type: dir
        path: ../scripts/flatpak-source
