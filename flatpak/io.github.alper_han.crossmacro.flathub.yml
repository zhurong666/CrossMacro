app-id: io.github.alper_han.crossmacro
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.dotnet10
command: crossmacro

finish-args:
  # X11 Access (Required for XTest, XInput2)
  - --share=ipc
  - --socket=x11
  
  # IBus for input method detection
  - --talk-name=org.kde.keyboard
  
  # User files (macro save/load)
  - --filesystem=xdg-documents/crossmacro:create


build-options:
  append-path: /usr/lib/sdk/dotnet10/bin
  append-ld-library-path: /usr/lib/sdk/dotnet10/lib
  env:
    DOTNET_CLI_TELEMETRY_OPTOUT: 'true'
    DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 'true'


modules:
  - name: crossmacro
    buildsystem: simple
    build-commands:
      # Restore and publish (Disable ReadyToRun to simplify dependencies)
      - dotnet publish src/CrossMacro.UI/CrossMacro.UI.csproj -c Release -r linux-x64 -p:PublishReadyToRun=false --self-contained --source nuget-sources -o /app/lib/crossmacro
      
      # Create wrapper script
      - mkdir -p /app/bin
      - |
        cat > /app/bin/crossmacro << 'EOF'
        #!/bin/sh
        exec /app/lib/crossmacro/CrossMacro.UI "$@"
        EOF
      - chmod +x /app/bin/crossmacro
      
      # Desktop entry
      - install -Dm644 flatpak/io.github.alper_han.crossmacro.desktop /app/share/applications/io.github.alper_han.crossmacro.desktop
      
      # Icons
      - install -Dm644 src/CrossMacro.UI/Assets/icons/512x512/apps/crossmacro.png /app/share/icons/hicolor/512x512/apps/io.github.alper_han.crossmacro.png
      - install -Dm644 src/CrossMacro.UI/Assets/icons/256x256/apps/crossmacro.png /app/share/icons/hicolor/256x256/apps/io.github.alper_han.crossmacro.png
      - install -Dm644 src/CrossMacro.UI/Assets/icons/128x128/apps/crossmacro.png /app/share/icons/hicolor/128x128/apps/io.github.alper_han.crossmacro.png
      
      # Metainfo
      - install -Dm644 flatpak/io.github.alper_han.crossmacro.metainfo.xml /app/share/metainfo/io.github.alper_han.crossmacro.metainfo.xml
      
      # License
      - install -Dm644 LICENSE /app/share/licenses/io.github.alper_han.crossmacro/LICENSE

    sources:
      # Main source from GitHub
      - type: git
        url: https://github.com/alper-han/CrossMacro.git
        tag: v0.8.4
        commit: 58319ee4999a84fa0d467e629e5fad8009cd3c4f
      
      # NuGet packages (offline)
      - nuget-sources.json
